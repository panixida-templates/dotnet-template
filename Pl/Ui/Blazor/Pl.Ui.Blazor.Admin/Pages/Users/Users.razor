@page "/users"
@inherits BaseFilterableTable<int, UserViewModel, UsersSearchParams, UsersConvertParams, IUsersService>

<PageTitle>@Title</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="pa-6">

    <MudStack Spacing="3">

        <MudText Typo="Typo.h5" Align="Align.Center">@Title</MudText>

        <ActionsPanel>
            <MudItem>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Size="Size.Small" OnClick="@OnAddClicked">
                    @AddButtonText
                </MudButton>
            </MudItem>
        </ActionsPanel>

        <FiltersPanel Expanded="@_filtersExpanded" ExpandedChanged="OnFiltersExpandedChanged" OnReset="ResetFilters">
            <UsersFilters SearchParams="_searchParams" OnChanged="OnFiltersChanged" />
        </FiltersPanel>

        <MudPaper Elevation="1">
            <MudTable T="UserViewModel" @ref="_table" ServerData="LoadServerData" Hover="true" Bordered="true" Striped="true" Loading="_loading">
                <HeaderContent>
                    <MudTh>
                        <MudTableSortLabel T="UserViewModel" SortLabel="@nameof(UserViewModel.Name)">
                            @typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Name))
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="UserViewModel" SortLabel="@nameof(UserViewModel.Email)">
                            @typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Email))
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="UserViewModel" SortLabel="@nameof(UserViewModel.Role)">
                            @typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Role))
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="UserViewModel" SortLabel="@nameof(UserViewModel.Phone)">
                            @typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Phone))
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="UserViewModel" SortLabel="@nameof(UserViewModel.Age)">
                            @typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Age))
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="UserViewModel" SortLabel="@nameof(UserViewModel.Birthday)">
                            @typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Birthday))
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        @Actions
                    </MudTh>
                </HeaderContent>

                <RowTemplate>
                    <MudTd DataLabel="@typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Name))">
                        @context.Name
                    </MudTd>
                    <MudTd DataLabel="@typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Email))">
                        @context.Email
                    </MudTd>
                    <MudTd DataLabel="@typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Role))">
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">
                            @context.Role?.GetDisplayName()
                        </MudChip>
                    </MudTd>
                    <MudTd DataLabel="@typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Phone))">
                        @PhoneHelper.ToDisplayRuPhone(context.Phone)
                    </MudTd>
                    <MudTd DataLabel="@typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Age))">
                        @context.Age
                    </MudTd>
                    <MudTd DataLabel="@typeof(UserViewModel).DisplayNameFor(nameof(UserViewModel.Birthday))">
                        @context.Birthday.ToString()
                    </MudTd>
                    <MudTd DataLabel="@Actions">
                        <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Primary" OnClick="@(() => OnEditClicked(context.Id))" />
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Color="Color.Error" OnClick="@(() => OnDeleteClicked(context.Id))" />
                    </MudTd>
                </RowTemplate>

                <PagerContent>
                    <MudTablePager PageSizeOptions="GetPageSizeOptions()" />
                </PagerContent>

                <NoRecordsContent>
                    <TableNoRecordsContent />
                </NoRecordsContent>

            </MudTable>

        </MudPaper>

    </MudStack>

</MudContainer>