@page "/users/edit"
@page "/users/edit/{Id:int}"
@inherits BaseEdit<int, UserViewModel, UsersSearchParams, UsersConvertParams, IUsersService>

<PageTitle>@Title</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="pa-6">

    <MudStack Spacing="3">
        <MudText Typo="Typo.h4" Align="Align.Center">
            @Title
        </MudText>

        @if (_loading)
        {
            <MudProgressLinear Indeterminate="true" />
        }
        else
        {
            @if (!string.IsNullOrWhiteSpace(_error))
            {
                <MudAlert Severity="Severity.Error" Variant="Variant.Outlined">
                    @_error
                </MudAlert>
            }

            <MudPaper Elevation="1" Class="pa-6">
                <EditForm Model="_model" OnValidSubmit="OnValidSubmit">

                    <FluentValidationValidator DisableAssemblyScanning="true" />

                    <MudGrid Spacing="3">

                        <MudItem xs="12" md="6" lg="4">
                            <MudTextField T="string"
                                          Label="@ModelType.DisplayNameFor(nameof(UserViewModel.Name))"
                                          @bind-Value="_model.Name"
                                          For="(() => _model.Name)"
                                          Variant="Variant.Outlined" />
                        </MudItem>

                        <MudItem xs="12" md="6" lg="4">
                            <EnumSelector TEnum="Role"
                                          @bind-Value="_model.Role"
                                          For="(() => _model.Role)"
                                          Label="@ModelType.DisplayNameFor(nameof(UserViewModel.Role))"
                                          Clearable="false" />
                        </MudItem>

                        <MudItem xs="12" md="6" lg="4">
                            <MudTextField T="string"
                                          Label="@ModelType.DisplayNameFor(nameof(UserViewModel.Email))"
                                          @bind-Value="_model.Email"
                                          For="(() => _model.Email)"
                                          Variant="Variant.Outlined"
                                          InputType="InputType.Email"
                                          Placeholder="user@example.com" />
                        </MudItem>

                        <MudItem xs="12" md="6" lg="4">
                            <MudTextField T="string"
                                          Label="@ModelType.DisplayNameFor(nameof(UserViewModel.Phone))"
                                          @bind-Value="_model.Phone"
                                          For="(() => _model.Phone)"
                                          Variant="Variant.Outlined"
                                          Mask="@PhoneMask"
                                          Adornment="Adornment.Start"
                                          AdornmentText="+7"
                                          Placeholder="(___) ___-__-__" />

                        </MudItem>

                        <MudItem xs="12" md="6" lg="4">
                            <MudNumericField T="int"
                                             Label="@ModelType.DisplayNameFor(nameof(UserViewModel.Age))"
                                             Value="_model.Age"
                                             ReadOnly="true"
                                             Variant="Variant.Outlined" />
                        </MudItem>

                        <MudItem xs="12" md="6" lg="4">
                            <MudDatePicker Label="@ModelType.DisplayNameFor(nameof(UserViewModel.Birthday))"
                                           @bind-Date="_model.Birthday"
                                           For="(() => _model.Birthday)"
                                           MaxDate="@DateTime.Today"
                                           Clearable="false"
                                           Variant="Variant.Outlined" />
                        </MudItem>

                    </MudGrid>

                    <EditFormActions IsEditMode="IsEditMode" Disabled="_saving" OnCancel="OnCancelClicked" />

                </EditForm>

            </MudPaper>
        }
    </MudStack>

</MudContainer>
